<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SimplyDoors Costing Tool v3.2</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #34495e;
            --accent: #2980b9;
            --bg: #f5f7fa;
            --border: #dcdde1;
            --cost-color: #2c3e50;
            --price-color: #27ae60;
            --warning: #f39c12;
            --margin-ui: #d35400;
        }
        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: #333;
            margin: 0;
            padding: 20px;
            padding-top: 40px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
            padding-bottom: 20px;
        }
        
        /* FLOATING COST WIDGET */
        .cost-floater {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            color: var(--primary);
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            border: 2px solid var(--primary);
            min-width: 240px;
            transition: transform 0.2s ease;
        }
        .cost-floater:hover { transform: scale(1.02); }
        
        .floater-header {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.7;
            margin-bottom: 4px;
            text-align: right;
            color: #666;
            width: 100%;
            border-bottom: 1px solid #eee;
            padding-bottom: 4px;
        }
        .main-number-container {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            margin-top: 5px;
        }
        .main-number {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--cost-color);
            line-height: 1;
            font-family: monospace;
        }
        .slab-count-badge {
            font-size: 0.75rem;
            background-color: var(--accent);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            margin-right: 10px;
            font-weight: bold;
            display: none;
            text-transform: uppercase;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .secondary-details {
            margin-top: 10px;
            padding-top: 8px;
            border-top: 2px dashed #eee;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.95rem;
        }
        .sell-price {
            color: var(--price-color);
            font-weight: bold;
            font-size: 1.2rem;
        }
        .profit-display {
            font-size: 0.85rem; 
            color: #7f8c8d; 
            margin-top: 4px;
            width: 100%;
            text-align: right;
        }

        header {
            background: var(--primary);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }
        header h1 { margin: 0; font-size: 1.5rem; }
        header p { margin: 5px 0 0; opacity: 0.8; font-size: 0.9rem; }

        .calculator-body { padding: 30px; }
        
        fieldset {
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 25px;
            background: #fff;
        }
        fieldset.margin-section {
            border: 2px solid var(--margin-ui);
            background-color: #fffbf8;
        }
        
        legend {
            font-weight: bold;
            color: var(--accent);
            padding: 0 10px;
            font-size: 1.1rem;
        }
        legend.margin-legend { color: var(--margin-ui); }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 6px; font-weight: 600; font-size: 0.9rem; color: var(--secondary); }
        select, input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 1rem;
            background-color: #fff;
        }
        select:focus, input:focus { border-color: var(--accent); outline: none; }

        .checkbox-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 12px;
        }
        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            border: 1px solid #eee;
            border-radius: 4px;
            transition: background 0.2s;
            cursor: pointer;
        }
        .checkbox-item:hover { background-color: #f8f9fa; }
        .checkbox-item input { margin-right: 12px; transform: scale(1.2); }
        .checkbox-item span { flex-grow: 1; font-size: 0.95rem; }
        .cost-badge {
            background: #e1e8ef;
            color: var(--secondary);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .alert {
            background-color: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            display: none;
            font-size: 0.9rem;
            border: 1px solid #f5c6cb;
        }
        
        .section-note {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 15px;
            font-style: italic;
        }

        /* Mobile Adjustment */
        @media (max-width: 600px) {
            .cost-floater {
                top: auto;
                bottom: 20px;
                right: 20px;
                left: 20px;
                align-items: center;
            }
            .floater-header { text-align: center; }
            body { padding-bottom: 150px; }
        }

        .hidden { display: none; }
    </style>
</head>
<body>

<div class="cost-floater">
    <div class="floater-header">Total Internal Cost</div>
    <div class="main-number-container">
        <span id="slabCountBadge" class="slab-count-badge">2 Slabs</span>
        <span class="main-number" id="floatingInternalCost">$0.00</span>
    </div>
    
    <div class="secondary-details">
        <span>Quote Price:</span>
        <span class="sell-price" id="floatingCustomerPrice">$0.00</span>
    </div>
    <div class="profit-display">
        Est. Profit: <span id="floatingProfit">$0.00</span>
    </div>
</div>

<div class="container">
    <header>
        <h1>SimplyDoors Costing Tool</h1>
        <p>Purchaser View: Woodgrain, Simpson Rift & Redi-Prime</p>
    </header>

    <div class="calculator-body">
        
        <fieldset class="margin-section">
            <legend class="margin-legend">1. Margin Configuration</legend>
            <div class="grid-3">
                <div class="form-group">
                    <label for="marginPercent">Target Gross Margin (%)</label>
                    <input type="number" id="marginPercent" value="30" step="1" min="0" max="99" onchange="calculate()">
                    <div class="section-note" style="margin-top:5px;">Price = Cost / (1 - Margin%)</div>
                </div>
                <div class="form-group">
                    <label>Markup Equivalent</label>
                    <div id="calculatedMarkup" style="font-weight:bold; color:var(--margin-ui); font-size:1.2rem; padding-top:8px;">1.43x</div>
                </div>
            </div>
        </fieldset>

        <fieldset>
            <legend>2. Slab Configuration</legend>
            <div class="grid-3">
                <div class="form-group">
                    <label for="doorStyle">Style Family</label>
                    <select id="doorStyle" onchange="updateConfig()">
                        <optgroup label="Woodgrain (Standard)">
                            <option value="molded">Molded Raised Panel</option>
                            <option value="flushHB">Flush Hardboard (Primed)</option>
                            <option value="flushBirch">Flush Birch</option>
                        </optgroup>
                        <optgroup label="Simpson Redi-Prime (Primed)">
                            <option value="rp8720">#8720 Shaker 1-Panel (Primed)</option>
                            <option value="rp8782">#8782 Shaker 2-Panel (Primed)</option>
                            <option value="rp8730">#8730 Shaker 3-Panel Equal (Primed)</option>
                            <option value="rp8760">#8760 Craftsman 3-Panel (Primed)</option>
                            <option value="rp8755">#8755 Shaker 5-Panel (Primed)</option>
                        </optgroup>
                        <optgroup label="Simpson Rift White Oak (Premium)">
                            <option value="rift720">#720 Shaker 1-Panel (Rift Oak)</option>
                            <option value="rift782">#782 Shaker 2-Panel (Rift Oak)</option>
                            <option value="rift730">#730 Shaker 3-Panel (Rift Oak)</option>
                            <option value="rift755">#755 Shaker 5-Panel (Rift Oak)</option>
                            <option value="rift1501Clear">#1501 1-Lite Clear Ovolo (Rift Oak)</option>
                            <option value="rift1501Satin">#1501 1-Lite Satin Etch (Rift Oak)</option>
                        </optgroup>
                    </select>
                </div>
                <div class="form-group">
                    <label for="doorHeight">Height</label>
                    <select id="doorHeight" onchange="updateConfig()">
                        <option value="68">6'8"</option>
                        <option value="70">7'0"</option>
                        <option value="80">8'0"</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="doorType">Thickness & Core</label>
                    <select id="doorType" onchange="updateConfig()">
                        </select>
                </div>
            </div>
            
            <div class="grid-3" style="margin-top: 15px;">
                <div class="form-group">
                    <label for="purchaseType">Purchasing Tier</label>
                    <select id="purchaseType" onchange="calculate()">
                        <option value="jobLot">Standard / Job Lot (Brkn Pallet)</option>
                        <option value="pallet">Warehouse Full Pallet</option>
                        <option value="drop">Drop / Container</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="doorWidth">Size (Width)</label>
                    <select id="doorWidth" onchange="calculate()">
                        </select>
                </div>
                <div class="form-group">
                    <label>Base Slab Cost</label>
                    <div id="baseSlabCost" style="font-size: 1.2rem; font-weight: bold; color: var(--cost-color); padding-top: 5px;">$0.00</div>
                    <div id="priceAlert" class="alert">Price N/A for this Tier/Size</div>
                </div>
            </div>

            <div id="dropShipAdders" class="hidden" style="margin-top: 15px; border-top: 1px dashed #ddd; padding-top: 15px;">
                <label style="color: var(--warning);">Drop Shipment Fees (Page 10)</label>
                <div class="checkbox-list">
                    <label class="checkbox-item">
                        <input type="checkbox" class="calc-trigger" value="21.00">
                        <span>Less than 5 items</span>
                        <span class="cost-badge">+$21.00</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" class="calc-trigger" value="10.50">
                        <span>Quantity 5-9 items</span>
                        <span class="cost-badge">+$10.50</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" class="calc-trigger" value="100.00">
                        <span>LTL Crating</span>
                        <span class="cost-badge">+$100.00</span>
                    </label>
                </div>
            </div>
        </fieldset>

        <fieldset>
            <legend>3. Production Services (Internal)</legend>
            <div class="section-note">Selecting a "Double" service automatically calculates cost for 2 slabs.</div>
            <div class="checkbox-list" id="productionList">
                </div>
        </fieldset>

        <fieldset>
            <legend>4. Component Materials</legend>
            <div class="section-note">Costs derived from "Unit Cost" in catalog.</div>
            <div class="checkbox-list" id="componentList">
                </div>
        </fieldset>

    </div>
</div>

<script>
    // --- DATABASE ---
    
    // Structure: Style -> Height -> Type -> Width -> [JobLot, Pallet, Drop]
    // Redi-Prime Map: JobLot=BrknPallet, Pallet=Pallet, Drop=Container
    
    const pricingDB = {
        // --- SIMPSON REDI-PRIME DATA (NEW) ---
        "rp8720": { // 1-Panel
            "68": {
                "138RP": { 
                    "1/6": [68.60, 60.53, 54.16], "1/8": [169.88, null, 55.67], "1/10": [169.88, null, 55.67],
                    "2/0": [69.85, 61.63, 55.15], "2/2": [184.49, null, 61.26], "2/4": [77.60, 68.47, 61.26],
                    "2/6": [80.80, 71.29, 63.79], "2/8": [84.36, 74.44, 66.60], "2/10": [88.95, 78.48, 70.22], "3/0": [88.95, 78.48, 70.22]
                },
                "134RP": {
                    "1/6": [104.71, 92.39, 82.66], "2/0": [116.25, 102.58, 91.78], "2/4": [128.11, 113.04, 101.14],
                    "2/6": [132.27, 116.71, 104.42], "2/8": [136.20, 120.18, 107.53], "3/0": [144.25, 127.28, 113.88]
                },
                "20MIN": { "2/8": [205.54, 205.54, null], "3/0": [219.25, 219.25, null] }
            },
            "80": {
                "138RP": {
                    "1/6": [84.49, 74.55, 66.71], "2/0": [95.27, 84.06, 75.21], "2/4": [104.95, 92.60, 82.85],
                    "2/6": [109.32, 96.46, 86.31], "2/8": [114.24, 100.80, 90.19], "2/10": [122.28, 107.89, 96.54], "3/0": [122.28, 107.89, 96.54]
                },
                "134RP": {
                    "2/0": [122.80, 108.35, 96.95], "2/4": [135.32, 119.40, 106.83], "2/6": [146.08, 128.89, 115.33],
                    "2/8": [152.40, 134.47, 120.32], "3/0": [157.16, 138.67, 124.07]
                },
                "20MIN": { "2/8": [236.02, 236.02, null], "3/0": [252.15, 252.15, null] }
            }
        },
        "rp8782": { // 2-Panel
            "68": {
                "138RP": { 
                    "1/6": [71.61, 63.19, 56.54], "1/8": [177.55, null, 57.45], "1/10": [177.55, null, 57.45],
                    "2/0": [72.77, 64.21, 57.45], "2/2": [196.55, null, 62.53], "2/4": [79.20, 69.88, 62.53],
                    "2/6": [82.75, 73.01, 65.33], "2/8": [86.64, 76.45, 68.40], "2/10": [95.16, 83.96, 75.13], "3/0": [95.16, 83.96, 75.13]
                },
                "134RP": {
                    "1/6": [109.17, 96.33, 86.19], "2/0": [125.84, 111.04, 99.35], "2/4": [131.23, 115.79, 103.60],
                    "2/6": [135.64, 119.68, 107.08], "2/8": [140.27, 123.76, 110.74], "3/0": [149.35, 131.78, 117.91]
                },
                "20MIN": { "2/8": [207.75, 207.75, null], "3/0": [223.81, 223.81, null] }
            },
            "80": {
                "138RP": {
                    "1/6": [89.76, 79.20, 70.86], "2/0": [93.89, 82.85, 74.13], "2/4": [103.92, 91.69, 82.04],
                    "2/6": [108.69, 95.91, 85.81], "2/8": [113.79, 100.40, 89.83], "2/10": [125.12, 110.40, 98.78], "3/0": [125.12, 110.40, 98.78]
                },
                "134RP": {
                    "1/6": [129.43, 114.20, 102.18], "2/0": [147.19, 129.87, 116.20], "2/4": [158.57, 139.92, 125.19],
                    "2/6": [164.29, 144.96, 129.71], "2/8": [170.24, 150.21, 134.40], "3/0": [181.95, 160.54, 143.64]
                },
                "20MIN": { "2/8": [285.19, 285.19, null], "3/0": [293.18, 293.18, null] }
            }
        },
        "rp8730": { // 3-Panel
            "68": {
                "138RP": { 
                    "1/6": [74.65, 65.87, 58.94], "1/8": [208.24, null, 59.16], "1/10": [208.24, null, 59.16],
                    "2/0": [74.93, 66.12, 59.16], "2/2": [226.87, null, 64.54], "2/4": [81.75, 72.13, 64.54],
                    "2/6": [85.32, 75.28, 67.36], "2/8": [89.25, 78.75, 70.46], "2/10": [97.88, 86.36, 77.27], "3/0": [97.88, 86.36, 77.27]
                },
                "20MIN": { "2/8": [211.71, 211.71, null], "3/0": [221.32, 221.32, null] }
            },
            "80": {
                "138RP": {
                    "1/6": [90.92, 80.22, 71.78], "2/0": [99.08, 87.42, 78.22], "2/4": [109.56, 96.67, 86.49],
                    "2/6": [114.36, 100.91, 90.28], "2/8": [119.71, 105.62, 94.51], "2/10": [128.51, 113.39, 101.45], "3/0": [128.51, 113.39, 101.45]
                },
                "20MIN": { "2/8": [287.85, 278.03, 326.23], "3/0": [295.96, 285.88, 335.43] }
            }
        },
        "rp8760": { // Craftsman
            "68": {
                "138RP": { 
                    "1/6": [60.80, 53.65, 48.00], "1/8": [188.88, 63.52, 56.83], "1/10": [188.88, 63.52, 56.83],
                    "2/0": [71.99, 63.52, 56.83], "2/2": [206.41, 70.35, 62.95], "2/4": [79.73, 70.35, 62.95],
                    "2/6": [83.15, 73.36, 65.64], "2/8": [86.87, 76.65, 68.58], "2/10": [95.07, 83.88, 75.05], "3/0": [95.07, 83.88, 75.05]
                },
                "20MIN": { "2/8": [239.93, 211.71, 204.49], "3/0": [250.83, 221.32, 213.77] }
            },
            "80": {
                "138RP": {
                    "1/6": [91.15, 80.42, 71.96], "2/0": [91.41, 80.66, 72.17], "2/4": [101.05, 89.16, 79.78],
                    "2/6": [105.48, 93.07, 83.27], "2/8": [110.20, 97.24, 87.00], "2/10": [120.75, 106.54, 95.33], "3/0": [120.75, 106.54, 95.33]
                },
                "20MIN": { "2/8": [326.23, 287.85, 278.03], "3/0": [335.43, 295.96, 285.88] }
            }
        },
        "rp8755": { // 5-Panel
            "68": {
                "138RP": { 
                    "1/6": [73.31, 64.68, 57.87], "1/8": [183.03, null, 61.60], "1/10": [183.03, null, 61.60],
                    "2/0": [78.03, 68.85, 61.60], "2/2": [201.67, null, 67.08], "2/4": [84.97, 74.98, 67.08],
                    "2/6": [88.13, 77.76, 69.58], "2/8": [92.08, 81.25, 72.69], "2/10": [99.79, 88.05, 78.78], "3/0": [99.79, 88.05, 78.78]
                },
                "20MIN": { "2/8": [221.32, 221.32, null], "3/0": [238.02, 238.02, null] }
            },
            "80": {
                "138RP": {
                    "1/6": [100.55, 88.72, 79.38], "2/0": [101.28, 89.36, 79.96], "2/4": [110.49, 97.49, 87.23],
                    "2/6": [114.61, 101.13, 90.48], "2/8": [117.00, 103.24, 92.37], "2/10": [126.77, 111.86, 100.08], "3/0": [126.77, 111.86, 100.08]
                },
                "20MIN": { "2/8": [270.16, 270.16, null], "3/0": [278.65, 278.65, null] }
            }
        },

        // --- WOODGRAIN DATA ---
        "molded": {
            "68": {
                "138HC": { "1/6": [41.49, 40.02, 35.57], "2/0": [43.63, 42.09, 34.11], "2/4": [46.66, 45.01, 39.62], "2/6": [47.65, 45.96, 40.40], "2/8": [49.79, 48.04, 42.09], "3/0": [52.83, 50.96, 44.47] },
                "138SC": { "1/6": [89.07, 85.93, 69.89], "2/0": [89.07, 85.93, 69.89], "2/4": [93.83, 90.52, 73.63], "2/6": [93.83, 90.52, 73.63], "2/8": [97.39, 93.95, 76.42], "3/0": [100.82, 97.26, 79.12] },
                "134SC": { "1/6": [95.20, 91.84, 74.69], "2/0": [95.20, 91.84, 74.69], "2/4": [99.57, 96.06, 78.14], "2/6": [99.57, 96.06, 78.14], "2/8": [102.84, 99.21, 80.69], "3/0": [106.00, 102.26, 83.17] }
            },
            "70": {
                "138HC": { "1/6": [66.63, 64.28, 57.55], "2/0": [68.85, 66.42, 59.29], "2/4": [71.98, 69.44, 61.74], "2/6": [72.99, 70.41, 62.54], "2/8": [75.21, 72.55, 64.28], "3/0": [78.35, 75.59, 66.74] },
                "138SC": { "1/6": [114.77, 110.72, 90.06], "2/0": [114.77, 110.72, 90.06], "2/4": [119.63, 115.41, 93.87], "2/6": [119.63, 115.41, 93.87], "2/8": [123.27, 118.92, 96.73], "3/0": [126.77, 122.29, 99.47] },
                "134SC": { "1/6": [129.46, 124.89, 101.58], "2/0": [129.46, 124.89, 101.58], "2/4": [134.33, 129.59, 105.40], "2/6": [134.33, 129.59, 105.40], "2/8": [137.95, 133.08, 108.25], "3/0": [141.46, 136.47, 111.00] }
            },
            "80": {
                "138HC": { "1/6": [81.34, 78.47, 71.19], "2/0": [83.43, 80.48, 72.83], "2/4": [86.34, 83.29, 75.12], "2/6": [87.29, 84.21, 75.86], "2/8": [89.38, 86.22, 77.51], "3/0": [92.32, 89.06, 79.81] },
                "138SC": { "1/6": [126.43, 121.96, 99.20], "2/0": [126.43, 121.96, 99.20], "2/4": [130.76, 126.14, 102.60], "2/6": [130.76, 126.14, 102.60], "2/8": [133.99, 129.26, 105.14], "3/0": [137.10, 132.26, 107.58] },
                "134SC": { "1/6": [131.66, 127.01, 103.31], "2/0": [131.66, 127.01, 103.31], "2/4": [135.74, 130.95, 106.52], "2/6": [135.74, 130.95, 106.52], "2/8": [138.79, 133.89, 108.91], "3/0": [141.73, 136.73, 111.22] }
            }
        },
        "flushHB": {
            "68": {
                "138HC": { "1/6": [38.13, 36.79, 33.08], "2/0": [39.90, 38.49, 34.47], "2/4": [40.85, 39.41, 35.22], "2/6": [42.17, 40.68, 36.24], "2/8": [45.40, 43.80, 38.78], "3/0": [50.18, 48.41, 42.54], "4/0": [null, null, 74.95] },
                "138SC": { "1/6": [88.91, 85.78, 69.77], "2/0": [90.11, 86.93, 70.71], "2/4": [93.32, 90.02, 73.22], "2/6": [93.32, 90.02, 73.22], "2/8": [96.84, 93.42, 75.99], "3/0": [102.67, 99.05, 80.57], "4/0": [null, null, 121.75] },
                "134SC": { "1/6": [105.99, 102.25, 83.17], "2/0": [105.99, 102.25, 83.17], "2/4": [109.27, 105.41, 85.74], "2/6": [109.27, 105.41, 85.74], "2/8": [112.87, 108.88, 88.56], "3/0": [118.82, 114.62, 93.23], "4/0": [null, null, 134.01] }
            },
            "70": {
                "138HC": { "1/6": [50.28, 50.27, 50.46], "2/0": [59.43, 57.33, 51.89], "2/4": [60.40, 58.27, 52.66], "2/6": [61.76, 59.58, 53.73], "2/8": [65.10, 62.80, 56.35], "3/0": [70.04, 67.56, 60.22], "4/0": [null, null, 91.23] },
                "138SC": { "1/6": [113.41, 109.41, 89.00], "2/0": [114.63, 110.59, 89.96], "2/4": [117.91, 113.75, 92.53], "2/6": [117.91, 113.75, 92.53], "2/8": [121.51, 117.22, 95.35], "3/0": [127.46, 122.96, 100.02], "4/0": [null, null, 142.08] },
                "134SC": { "1/6": [128.62, 124.08, 100.94], "2/0": [128.62, 124.08, 100.94], "2/4": [131.90, 127.25, 103.51], "2/6": [131.90, 127.25, 103.51], "2/8": [135.50, 130.72, 106.33], "3/0": [141.46, 136.47, 111.00], "4/0": [null, null, 151.78] }
            },
            "80": {
                "138HC": { "1/6": [90.78, 87.58, 78.61], "2/0": [92.50, 89.24, 79.95], "2/4": [93.41, 90.12, 80.67], "2/6": [94.68, 91.34, 81.66], "2/8": [97.82, 94.36, 84.12], "3/0": [102.45, 98.84, 87.76], "4/0": [null, null, 116.82] },
                "138SC": { "1/6": [149.39, 144.12, 117.23], "2/0": [150.61, 145.29, 118.18], "2/4": [153.89, 148.46, 120.76], "2/6": [153.89, 148.46, 120.76], "2/8": [157.49, 151.93, 123.58], "3/0": [163.44, 157.67, 128.25], "4/0": [null, null, 170.32] },
                "134SC": { "1/6": [164.60, 158.79, 129.16], "2/0": [164.60, 158.79, 129.16], "2/4": [167.88, 161.95, 131.74], "2/6": [167.88, 161.95, 131.74], "2/8": [171.48, 165.42, 134.56], "3/0": [177.43, 171.16, 139.23], "4/0": [null, null, 180.00] }
            }
        },
        "flushBirch": {
            "68": {
                "138HC": { "1/6": [null, 49.55, 40.31], "2/0": [null, 51.66, 42.01], "2/4": [null, 56.20, 45.71], "2/6": [null, 58.68, 47.74], "2/8": [null, 60.25, 49.01], "3/0": [null, 64.45, 52.42], "4/0": [null, null, 92.36] },
                "138SC": { "1/6": [null, 98.99, 80.52], "2/0": [null, 100.51, 81.75], "2/4": [null, 107.01, 87.04], "2/6": [null, 107.01, 87.04], "2/8": [null, 108.51, 88.26], "3/0": [null, 112.51, 91.52], "4/0": [null, null, 124.05] },
                "134HC": { "1/6": [null, 126.00, 103.93], "2/0": [null, 129.16, 106.49], "2/4": [null, 130.76, 107.80], "2/6": [null, 132.75, 109.42], "2/8": [null, 136.92, 112.80], "3/0": [null, 146.01, 120.21], "4/0": [null, null, 172.86] },
                "134SC": { "1/6": [null, 108.35, 88.14], "2/0": [null, 111.52, 90.71], "2/4": [null, 113.12, 92.01], "2/6": [null, 115.11, 93.63], "2/8": [null, 119.27, 97.01], "3/0": [null, 128.36, 104.42], "4/0": [null, null, 157.07] }
            },
            "70": {
                "138HC": { "1/6": [null, 105.85, 57.63], "2/0": [null, 107.88, 59.39], "2/4": [null, 112.28, 63.20], "2/6": [null, 114.68, 65.29], "2/8": [null, 116.20, 66.61], "3/0": [null, 120.26, 70.13], "4/0": [null, null, 111.36] },
                "138SC": { "1/6": [null, 157.61, 99.98], "2/0": [null, 159.15, 101.23], "2/4": [null, 165.81, 106.64], "2/6": [null, 165.81, 106.64], "2/8": [null, 167.33, 107.88], "3/0": [null, 171.42, 111.20], "4/0": [null, null, 144.43] },
                "134HC": { "1/6": [null, 150.20, 123.80], "2/0": [null, 153.36, 126.37], "2/4": [null, 154.96, 127.67], "2/6": [null, 156.95, 129.28], "2/8": [null, 161.12, 132.67], "3/0": [null, 170.21, 140.07], "4/0": [null, null, 192.74] },
                "134SC": { "1/6": [null, 130.20, 105.91], "2/0": [null, 133.36, 108.47], "2/4": [null, 134.96, 109.78], "2/6": [null, 136.95, 111.39], "2/8": [null, 141.12, 114.78], "3/0": [null, 150.21, 122.18], "4/0": [null, null, 174.84] }
            },
            "80": {
                 "138HC": { "1/6": [null, 105.85, 86.09], "2/0": [null, 107.88, 87.75], "2/4": [null, 112.28, 91.33], "2/6": [null, 114.68, 93.28], "2/8": [null, 116.20, 94.52], "3/0": [null, 120.26, 97.82], "4/0": [null, null, 136.46] },
                "138SC": { "1/6": [null, 157.61, 128.20], "2/0": [null, 159.15, 129.46], "2/4": [null, 165.81, 134.87], "2/6": [null, 165.81, 134.87], "2/8": [null, 167.33, 136.11], "3/0": [null, 171.42, 139.43], "4/0": [null, null, 172.66] },
                "134HC": { "1/6": [null, 188.44, 155.19], "2/0": [null, 191.60, 157.76], "2/4": [null, 193.20, 159.06], "2/6": [null, 195.18, 160.67], "2/8": [null, 199.34, 164.06], "3/0": [null, 208.45, 171.46], "4/0": [null, null, 224.13] },
                "134SC": { "1/6": [null, 164.91, 134.14], "2/0": [null, 168.07, 136.71], "2/4": [null, 169.67, 138.01], "2/6": [null, 171.65, 139.62], "2/8": [null, 175.81, 143.01], "3/0": [null, 184.92, 150.41], "4/0": [null, null, 203.07] }
            }
        },
        
        // --- SIMPSON RIFT WHITE OAK DATA ---
        "rift720": {
            "68": { 
                "138SR": { "1/6": [210.52, 210.52, 210.52], "2/0": [229.95, 229.95, 229.95], "2/4": [245.06, 245.06, 245.06], "2/6": [251.54, 251.54, 251.54], "2/8": [260.17, 260.17, 260.17], "2/10": [286.08, 286.08, 286.08], "3/0": [292.40, 292.40, 292.40] },
                "20MIN": { "2/8": [1050.90, 1050.90, 1050.90], "3/0": [1050.90, 1050.90, 1050.90] }
            },
            "80": { 
                "138SR": { "1/6": [234.30, 234.30, 234.30], "2/0": [258.00, 258.00, 258.00], "2/4": [275.30, 275.30, 275.30], "2/6": [281.75, 281.75, 281.75], "2/8": [292.55, 292.55, 292.55], "2/10": [301.20, 301.20, 301.20], "3/0": [305.50, 305.50, 305.50] },
                "20MIN": { "2/8": [1213.40, 1213.40, 1213.40], "3/0": [1213.40, 1213.40, 1213.40] }
            }
        },
        "rift782": {
            "68": { 
                "138SR": { "1/6": [219.16, 219.16, 219.16], "2/0": [236.43, 236.43, 236.43], "2/4": [253.70, 253.70, 253.70], "2/6": [260.14, 260.14, 260.14], "2/8": [268.81, 268.81, 268.81], "2/10": [277.45, 277.45, 277.45], "3/0": [283.93, 283.93, 283.93] },
                "20MIN": { "2/8": [1073.70, 1073.70, 1073.70], "3/0": [1073.70, 1073.70, 1073.70] }
            },
            "80": { 
                "138SR": { "1/6": [245.06, 245.06, 245.06], "2/0": [268.81, 268.81, 268.81], "2/4": [286.10, 286.10, 286.10], "2/6": [294.72, 294.72, 294.72], "2/8": [303.36, 303.36, 303.36], "2/10": [314.15, 314.15, 314.15], "3/0": [322.79, 322.79, 322.79] },
                "20MIN": { "2/8": [1239.72, 1239.72, 1239.72], "3/0": [1239.72, 1239.72, 1239.72] }
            }
        },
        "rift730": {
            "68": { 
                "138SR": { "1/6": [223.47, 223.47, 223.47], "2/0": [240.75, 240.75, 240.75], "2/4": [258.00, 258.00, 258.00], "2/6": [266.65, 266.65, 266.65], "2/8": [275.30, 275.30, 275.30], "2/10": [286.10, 286.10, 286.10], "3/0": [290.40, 290.40, 290.40] },
                "20MIN": { "2/8": [1081.47, 1081.47, 1081.47], "3/0": [1081.47, 1081.47, 1081.47] }
            },
            "70": { 
                "138SR": { "2/0": [240.75, 240.75, 240.75], "2/4": [258.00, 258.00, 258.00], "2/6": [266.65, 266.65, 266.65], "2/8": [275.29, 275.29, 275.29], "2/10": [286.10, 286.10, 286.10], "3/0": [290.40, 290.40, 290.40] },
                "20MIN": { "2/8": [1081.47, 1081.47, 1081.47], "3/0": [1081.47, 1081.47, 1081.47] }
            }
        },
        "rift755": {
            "68": { 
                "138SR": { "1/6": [232.10, 232.10, 232.10], "2/0": [255.86, 255.86, 255.86], "2/4": [275.30, 275.30, 275.30], "2/6": [286.08, 286.08, 286.08], "2/8": [296.90, 296.90, 296.90], "2/10": [307.70, 307.70, 307.70], "3/0": [314.15, 314.15, 314.15] },
                "20MIN": { "2/8": [1081.47, 1081.47, 1081.47], "3/0": [1081.47, 1081.47, 1081.47] }
            },
            "70": { 
                "138SR": { "2/0": [255.85, 255.85, 255.85], "2/4": [275.30, 275.30, 275.30], "2/6": [286.10, 286.10, 286.10], "2/8": [296.89, 296.89, 296.89], "2/10": [307.69, 307.69, 307.69], "3/0": [314.15, 314.15, 314.15] },
                "20MIN": { "2/8": [1081.47, 1081.47, 1081.47], "3/0": [1081.47, 1081.47, 1081.47] }
            }
        },
        "rift1501Clear": {
            "68": { "138SR": { "2/0": [158.55, 158.55, 158.55], "2/4": [169.44, 169.44, 169.44], "2/6": [173.88, 173.88, 173.88], "2/8": [180.34, 180.34, 180.34], "2/10": [182.40, 182.40, 182.40], "3/0": [189.20, 189.20, 189.20] } },
            "80": { "138SR": { "2/0": [163.60, 163.60, 163.60], "2/6": [175.80, 175.80, 175.80], "2/8": [187.95, 187.95, 187.95], "2/10": [190.00, 190.00, 190.00], "3/0": [198.10, 198.10, 198.10] } }
        },
        "rift1501Satin": {
            "68": { "138SR": { "2/0": [163.60, 163.60, 163.60], "2/6": [175.80, 175.80, 175.80], "2/8": [187.95, 187.95, 187.95], "2/10": [190.00, 190.00, 190.00], "3/0": [198.10, 198.10, 198.10] } }
        }
    };

    const typeLabels = {
        "138HC": "1-3/8\" Hollow Core",
        "138SC": "1-3/8\" Solid Core",
        "134SC": "1-3/4\" Solid Core",
        "134HC": "1-3/4\" Hollow Core",
        "138SR": "1-3/8\" Rift Oak Stile & Rail",
        "138RP": "1-3/8\" Redi-Prime Shaker",
        "134RP": "1-3/4\" Redi-Prime Shaker",
        "20MIN": "20-Min Fire Rated (1-3/4\")"
    };

    const productionAdders = [
        { name: "Prehang 6'8 Single (Std 4-9/16)", cost: 25.00 },
        { name: "Prehang 8'0 Single (Std 4-9/16)", cost: 32.00 },
        { name: "Upcharge to Interior 6-9/16 Jamb", cost: 20.00 },
        { name: "Prehang 6'8 Double Ball Catch", cost: 55.00 },
        { name: "Prehang 6'8 Double Flush Bolt", cost: 85.00 },
        { name: "Prehang 8'0 Double Flush Bolt", cost: 95.00 },
        { name: "Prehang 8'0 Double Ball Catch", cost: 50.00 },
        { name: "Upcharge to Primed FJ Jamb", cost: 5.00 },
        { name: "Prehang Ext 6'8 Single", cost: 125.00 },
        { name: "Prehang Ext 8'0 Single", cost: 150.00 },
        { name: "Prehang Ext 6'8 Double", cost: 320.00 },
        { name: "Prehang Ext 8'0 Double", cost: 340.00 },
        { name: "Slab Cutdown", cost: 10.00 },
        { name: "Hinge Prep (Per Slab)", cost: 30.00 },
        { name: "Bore Prep (Per Slab)", cost: 20.00 },
        { name: "Dutch Door Mod", cost: 100.00 },
        { name: "Casing Pre Applied", cost: 5.00 },
        { name: "Precut Casing Adder", cost: 5.00 }
    ];

    const componentAdders = [
        { name: "Flat Jamb 6-8 4-5/8 FJ Raw Pine (W/Stop)", cost: 11.06 },
        { name: "Flat Jamb 8-0 4-5/8 FJ Raw Pine (W/Stop)", cost: 12.61 },
        { name: "Flat Jamb 6-8 4-7/8 FJ Primed", cost: 10.80 },
        { name: "Flat Jamb 8-0 6-9/16 FJ Pine", cost: 14.56 },
        { name: "Flat Jamb 6-5/8 x 8-0 Primed (Pair)", cost: 18.14 },
        { name: "Stop 3/8 x 1-1/4 x 14' Primed", cost: 3.51 },
        { name: "Stop 3/8 x 1-1/4 x 80-7/8 (Raw)", cost: 0.89 },
        { name: "Stop 3/8 x 1-1/4 x 96-7/8 (Raw)", cost: 0.98 },
        { name: "LF WM887 3/8x1-1/4 Stop FJ Primed", cost: 0.31 },
        { name: "Oak Jambs 4-9/16 x 97\" (Pair)", cost: 94.10 },
        { name: "Oak Jambs 6-9/16 x 97\" (Pair)", cost: 126.90 },
        { name: "Oak Stop 3/8 x 1-3/8 x 98\" (Each)", cost: 12.98 }
    ];

    // --- LOGIC ---

    function init() {
        renderCheckboxes(productionAdders, 'productionList');
        renderCheckboxes(componentAdders, 'componentList');
        
        document.querySelectorAll('.calc-trigger').forEach(el => {
            el.addEventListener('change', calculate);
        });

        updateConfig();
    }

    function renderCheckboxes(data, containerId) {
        const container = document.getElementById(containerId);
        data.forEach(item => {
            const label = document.createElement('label');
            label.className = 'checkbox-item';
            label.innerHTML = `
                <input type="checkbox" class="calc-trigger" value="${item.cost}" data-name="${item.name}">
                <span>${item.name}</span>
                <span class="cost-badge">$${item.cost.toFixed(2)}</span>
            `;
            container.appendChild(label);
        });
    }

    function updateConfig() {
        const style = document.getElementById('doorStyle').value;
        const height = document.getElementById('doorHeight').value;
        const typeSelect = document.getElementById('doorType');
        const widthSelect = document.getElementById('doorWidth');

        const currentType = typeSelect.value;
        const currentWidth = widthSelect.value;

        typeSelect.innerHTML = "";
        const availableTypes = pricingDB[style][height];
        
        if (availableTypes) {
            Object.keys(availableTypes).forEach(key => {
                const opt = document.createElement('option');
                opt.value = key;
                opt.text = typeLabels[key] || key;
                typeSelect.add(opt);
            });
            if (availableTypes[currentType]) {
                typeSelect.value = currentType;
            }
        } else {
            typeSelect.add(new Option("Not Available in this Height", ""));
        }

        widthSelect.innerHTML = "";
        const selectedType = typeSelect.value;
        if (availableTypes && availableTypes[selectedType]) {
            const sizes = availableTypes[selectedType];
            Object.keys(sizes).forEach(size => {
                widthSelect.add(new Option(size, size));
            });
            if (sizes[currentWidth]) widthSelect.value = currentWidth;
        }

        const purchaseType = document.getElementById('purchaseType').value;
        const dropSection = document.getElementById('dropShipAdders');
        if (purchaseType === 'drop') {
            dropSection.classList.remove('hidden');
        } else {
            dropSection.classList.add('hidden');
            dropSection.querySelectorAll('input').forEach(i => i.checked = false);
        }

        calculate();
    }

    function calculate() {
        // 1. Base Cost
        const style = document.getElementById('doorStyle').value;
        const height = document.getElementById('doorHeight').value;
        const type = document.getElementById('doorType').value;
        const width = document.getElementById('doorWidth').value;
        const tier = document.getElementById('purchaseType').value;
        
        const tierIndex = (tier === 'jobLot') ? 0 : (tier === 'pallet') ? 1 : 2;

        let baseCost = 0;
        let validPrice = true;

        try {
            const rawPrice = pricingDB[style][height][type][width][tierIndex];
            if (rawPrice === null) validPrice = false;
            else baseCost = rawPrice;
        } catch (e) {
            validPrice = false;
        }

        // 2. Logic to detect "Double" in checked production adders
        let slabCount = 1;
        let addersTotal = 0;
        
        document.querySelectorAll('.calc-trigger:checked').forEach(box => {
            addersTotal += parseFloat(box.value);
            // Check if label contains "Double"
            const name = box.dataset.name || "";
            if (name.includes("Double")) {
                slabCount = 2;
            }
        });

        // Update Base Display to reflect slab count
        const baseDisplay = document.getElementById('baseSlabCost');
        const alertBox = document.getElementById('priceAlert');
        const slabBadge = document.getElementById('slabCountBadge');
        
        if (validPrice) {
            if (slabCount === 2) {
                const totalSlabCost = baseCost * 2;
                baseDisplay.innerText = `$${baseCost.toFixed(2)} x 2 = $${totalSlabCost.toFixed(2)}`;
                slabBadge.style.display = "inline-block";
                baseCost = totalSlabCost; // Use total for final calc
            } else {
                baseDisplay.innerText = "$" + baseCost.toFixed(2);
                slabBadge.style.display = "none";
            }
            baseDisplay.style.color = "var(--cost-color)";
            alertBox.style.display = "none";
        } else {
            baseDisplay.innerText = "N/A";
            baseDisplay.style.color = "#ccc";
            alertBox.style.display = "block";
            slabBadge.style.display = "none";
            baseCost = 0;
        }

        // 3. Internal Cost
        const totalInternalCost = baseCost + addersTotal;

        // 4. Margin Calculation
        // Formula: Price = Cost / (1 - Margin%)
        const marginInput = parseFloat(document.getElementById('marginPercent').value) || 0;
        const marginDecimal = marginInput / 100;
        
        let customerPrice = 0;
        let markupEquivalent = 0;

        if (marginDecimal >= 1) {
            customerPrice = 0; 
        } else {
            customerPrice = totalInternalCost / (1 - marginDecimal);
        }
        
        const profit = customerPrice - totalInternalCost;
        
        if (totalInternalCost > 0) {
            markupEquivalent = customerPrice / totalInternalCost;
        }

        // 5. Update UI
        document.getElementById('floatingInternalCost').innerText = "$" + totalInternalCost.toFixed(2);
        document.getElementById('floatingCustomerPrice').innerText = "$" + customerPrice.toFixed(2);
        document.getElementById('floatingProfit').innerText = "+" + "$" + profit.toFixed(2);
        document.getElementById('calculatedMarkup').innerText = markupEquivalent.toFixed(2) + "x";
    }

    init();
</script>

</body>
</html>
